よくある質問
===========

## 設計思想

### 開発の経緯は？

オープンソースかつスマートフォンで動くノベルのゲームエンジンがなかったことが開発のきっかけです。
実際に作ってみると一筋縄では行かなかったのですが、ノベルがスマートフォンでも流行ってくれるといいなと思いながらがんばっています。

### スマートフォンの何が難しいの？

スマートフォンって、冷却ファンをつけられないせいで、コンピュータとしては性能がすごく低いんですね……。
スマートフォンはPCのだいたい1/100くらいの性能しかないんです。

例えばPCだと問題なくCPUでレンダリングできる処理が、スマートフォンだと1秒はできるけどそれ以上は発熱でクロックが下がって使いものにならないようなことが起こります。
そこでGPUでレンダリングする必要があるわけですけど、スマートフォンの機種によって1フレームあたり何枚のポリゴンを描画できるかの性能が全然違うんです。
結局、最初の1フレームと最後の1フレームをCPUでレンダリングして、その間のクロスフェードのみをGPUで処理する方式になりました。
CPUが熱くなりすぎないうちに一瞬だけレンダリングで使う分には問題なかったのと、クロスフェードであればポリゴン2枚の描画で済むので最廉価機のGPUでも処理できたんです。

OpenNovelにはスマートフォンゲームのノウハウやバランス感覚が詰まっているのですが、スマートフォンゲームの開発に苦労した方でないと、そのありがたみは伝わらないかもしれないです。
演出が派手なソフトではないので、どうしても一般受けはしづらいのですが、わかる人には「だよねー」と言ってもらえるマニアックな代物に仕上がっています。

### 演出が少ないのでは？

前述の通り、消費電力の低いスマートフォンでゲームを動作させるには演出の割り切りが不可欠です。
そのためにレイヤ数に制限をかけています。
レイヤをやりくりすれば基本的な演出（たとえば雨や雪など）は問題なくできますが、工夫が必要です。
もし演出にもの足りなさを感じているなら、レイヤーとアニメの使いこなしで解決できるかもしれません。

### スクリプトが簡素すぎるのでは？

いいところに気がつきましたね！

他のゲームエンジンでは、何でもできるスクリプト言語、つまり「汎用プログラミング言語」を用いるのが一般的です。
これに対して、OpenNovelでは「ドメイン特化言語」というアプローチを用いているため、スクリプトが簡素に見えます。
汎用プログラミング言語では、例えば画面に文字を表示するとして、「どうやって表示を行うか」を記述します。
一方、ドメイン特化言語では、「どんな文字を表示するか」を記述します。
すると、前者では立派なプログラムができあがりますが、後者では一見するとただの文章ができあがります。
この違いが、スクリプトを簡素に見せています。
このような仕組みは、簡単な言葉だと「テンプレート」と呼ばれることがありますね。

では、OpenNovelではどうしてドメイン特化言語を採用しているのでしょうか。その理由は移植性です。
例えば、汎用プログラミング言語で画面表示の記述を行うことを考えます。
このとき、64枚のレイヤを用いて演出を行ったとします。
このプログラムは性能の高いPCでは問題なく動作するでしょう。
一方、性能の低いスマートフォンではどうでしょうか。
実はメモリサイズや実行速度の違いで、PCと同じようには動作しない可能性が高いです。
このように、汎用プログラミング言語を用いて「どのように表示するか」ということにフォーカスしたプログラムを書くと、移植性が問題になります。

ドメイン特化言語では、「どのように」、つまり64枚のレイヤを用いて、という部分を記述しません。
単に「どんな画面表示がほしいか」という情報だけを記述します。
その結果、PCでは64枚のレイヤを使う一方で、スマートフォンでは16枚のレイヤを使う、というような、エンジン側での実装の切り替えが可能になります。
これにより移植性を確保しているんですね。

別なアプローチのエンジンもあり、例えば吉里吉里では、汎用プログラミング言語TJSの上でドメイン特化言語KAGを実装するという２階層の構成を取っています。
ですが、吉里吉里で動くゲームの実際の運用としては、KAGの機能が足りないところはTJSで補い、それでも足りない機能はOSの上で動くDLLの呼び出しで補っています。
その結果、定番のDLLのような存在が生じていますが、OpenNovelではこのような定番の機能を完全にエンジン内に実装してしまっています。
ようするに、ゲームを実現するのにどんな機能が必要なのか、最初からわかっていれば、拡張性を用意しなくてもドメイン特化言語のみでの記述が可能である、というわけです。
逆の見方をすると、汎用プログラミング言語で記述しなければならないケースでは、エンジン開発者の「ドメイン分析」が足りていないということが言えます。

## 他のゲームエンジンとの比較

### OpenNovelにはどんな特徴がありますか

OpenNovelはスマートフォンで動くゲームを作ることに特化しています。
2024年現在ですと、スマートフォンで動くゲームを作るにはUnityというゲームエンジンの使用が一般的ですが、OpenNovelのスマートフォン版ではUnityを使用していません。
つまりUnityのライセンス料が不要であり、小さなゲームスタジオにはうれしいと思います。
また、家庭用ゲーム機への移植は従来大きな費用がかかるものでしたが、これを移植作業不要でそのまま動作可能としていることから、インディーから商業へ移るコストを低く抑えられることも特徴です。
OpenNovelの家庭用ゲーム機版はUnityを使用しています。

### 他のエンジンとの比較表はありますか？

|エンジン              |ライセンス|Windows対応|Mac対応|iOS対応|Android対応|Web対応|Linux対応|ゲーム機対応|
|----------------------|----------|-----------|-------|-------|-----------|-------|---------|------------|
|OpenNovel             |○        |○         |○     |○     |○         |○     |○       |○          |
|Unity 宴              |×        |○         |○     |○     |○         |○     |○       |○          |
|吉里吉里Z             |○        |○         |×     |×     |△         |×     |×       |×          |
|Artemis Engine        |×        |○         |×     |○     |○         |○     |×       |○          |
|ティラノスクリプト    |×        |○         |△     |△     |△         |○     |△       |△          |

* ライセンスの○はオープンソースライセンスで、×は非オープソースライセンスです
* 対応状況の△は一応動作するが商用品質と言いがたいものです

全部○なのはOpenNovelだけです。

### 他のエンジンからOpenNovelに移行したいです

すでに述べたように、汎用プログラミング言語とドメイン特化言語の違いがあるため、スクリプトを一対一で移植するような移行作業にはなりません。
OpenNovelの機能をサンプルゲームで把握していただき、設定ファイルを設計したり、画面に対応するGUIファイルを書き起こすことになります。

### 他のエンジンではできる○○という機能がないので実装してくれますか？

スマートフォンでも実装できる機能であれば対応させていただきます。

## ゲーム制作関連

## 複数のキャラクタをまとめて表示できますか？

* [@chch](reference.html#chch) コマンドを利用していただければ複数のキャラクタを一括変更できます
* より高度なキャラクタ演出を行える [Ciel](reference.html#ciel) という演出システムもあります

### キャラクタ変更中にメッセージボックスを表示したままにするには？

project.txt ファイルの下記の箇所を書き換えて、`=no` を `=yes` に変更してください。

```
msgbox.show.on.ch=yes
```

### メッセージボックスの横にキャラクタの顔を表示したいです

* [@ch](reference.html#ch) コマンドを使って、キャラクタ画像として `face` という位置に表示します
* コマンド行としては `@ch face ファイル名.png` のような記述になります
* `face` の位置に表示する画像は、フェードイン・フェードアウトの時間指定が無視され、必ず一瞬で表示されます

### 表情の差分を顔のパーツだけで実現したいです

* 読み込み時間、メモリ使用量、合成時間を考えると、スマートフォンには荷が重いと考え、この機能は現在のところ実装されていません

### フォントが変更できません

* セーブデータにフォントファイル名が記録されることで、変更したフォントが反映されなかったり、指定していないはずのフォントファイルが開けないというエラーが出ます
* ツールを終了した状態で、セーブデータのフォルダ <code>sav</code> を削除し、ツールを再度起動することで解決します

### タイトル画面の作り方がわかりません

* [@gui](reference.html#gui) というコマンドを使います
* 画面の内容は GUI ファイルというテキストファイルに書きます
* 詳しくは [GUI](gui.html) で解説しています

### 主人公の名前を入力できますか？

* 名前変数を使って入力できます
* 名前変数は `%a` から `%z` までの26個が利用可能です

### 目パチ画像の作り方を教えてください

* [目パチ](eye-blink.html) にまとめてあります

### 口パク画像の作り方を教えてください

* [口パク](lip-sync.html) にまとめてあります

### 日付や好感度を表示したいです

* テキストレイヤに枠画像を読み込んで、[@text](reference.html#text) で文字や数値を表示します
* 文字列の中に `$1` や `%a` などのように変数を記述すれば、数値や名前が表示されます

### 画面全体にフィルターをかけたいです

* エフェクトレイヤーが使えます
* 一番廉価な水準のAndroid端末だと描画性能的にギリギリになるため、積極的にはおすすめしていません
* できるだけカラーフィルター適用済みの画像を作成していただけますようお願いします
* 色を変更した画像が増えることで素材サイズが気になる場合、WebP形式での圧縮である程度解決できます

### マクロ機能はありますか？

* あります。[@gosub](reference.html#gosub) が利用できます
* マクロを外部ファイルにまとめるには、[using 文](reference.html#using) を使います
* `&マクロ名 引数` の形式でスクリプトを見やすく記述できます

### CG鑑賞モードを作れますか？

* [@gui](reference.html#gui) を使えば実現できます
* CGのサムネイルをボタンで表現します
* ボタンの設定に `type: gallery;` を指定して、さらに `var: $1;` のように変数を指定します
* 変数の値が0であればボタンは表示されません
* 変数の値が0以外であればボタンが表示されます

### 分岐チャートを作れますか？

* [@gui](reference.html#gui) を使えば実現できます
* すでに見たルートの部分をCGモードと同じ仕組みで表示するとよいです

### 全画面スタイルのノベルゲームを作れますか？

* はい。また、ゲームの途中でメッセージボックスを変更すれば、ノベルスタイルとアドベンチャースタイルを切り替え可能です

### ルビの中央寄せはできますか？

* 今のところできません。半角スペースを使って手動調整していただいています

### 多言語対応していますか？

* 対応しています。[多言語化](multilingual.html) をご覧ください

### WMSの使い方はどこに書いてありますか？

* [WMS](wms.html) をご覧ください

### 音声ファイルのビットレートはどうすればいいですか？

* PC向けのゲーム
    * BGM ... ステレオ 128kbps
    * SE ... ステレオ 128kbps
    * ボイス ... モノラル 64kbps
* スマートフォン
    * すべて モノラル 48kbps

スマートフォンはスピーカーが1つのことが多いのでモノラル推奨です。
また、スマホ本体の小さなスピーカーではプレイ感に影響が出にくいため、アプリサイズ削減を優先して低ビットレートにできます。
ただし、イヤホンでプレイされることが想定される場合は、プレイ感に影響が出ないよう、PC向けと同じ設定をおすすめします

### フラグ管理が大変です

* コンフィグファイルでフラグに名前をつけ、何のフラグなのかコメントを書き残してください
* 作品を長期にわたって保守して行く上で、よい設計資料になると考えています
* １年後のあなたにも読めばすぐわかるようにコメントを書くのが望ましいと考えます

## ゲーム配布

### Windowsでの正式な動作環境を教えてください

* 公開先に動作環境を申請する場合は、Windows XP以降対応、DirectX 9以降必須、Pentium 4以降必須と書けばよいです

### 公開場所はどうすればいいですか？

* Windows
    * Steam や DLsite での販売がおすすめです
    * 審査基準はきちんと起動してプレイできるかが中心です
    * 販売のハードルが高い場合、まずは「ふりーむ！」様での無償公開を目標とされることをおすすめします
* iOS
    * App Store で公開する必要があります
    * 審査基準は Apple がほしいと思うかに尽きると思います
* Android
    * Google Drive などに APK ファイルをアップロードすれば、Android でダウンロードしてインストールできます
    * booth や DLsite では有償で販売できるのでおすすめです
    * Google Play ストアでの公開は少しハードルが高いですが、慣れれば難しくないです
* Webブラウザ
    * itch.io がおすすめです
* 家庭用ゲーム機
    * 各ゲーム機メーカーのWebサイトで開発者登録を行います
    * 作品の申請を行います
    * 申請にあたっては「ミドルウェア」や「ゲームエンジン」の欄に「Unity」と記述してください
